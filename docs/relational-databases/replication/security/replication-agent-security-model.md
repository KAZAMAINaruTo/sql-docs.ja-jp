---
title: "レプリケーション エージェントのセキュリティ モデル | Microsoft Docs"
ms.custom: ""
ms.date: "10/07/2015"
ms.prod: "sql-server-2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "replication"
ms.tgt_pltfrm: ""
ms.topic: "article"
helpviewer_keywords: 
  - "スナップショット エージェント, セキュリティ"
  - "エージェント [SQL Server レプリケーション], セキュリティ"
  - "ディストリビューション エージェント, セキュリティ"
  - "ログイン [SQL Server レプリケーション], エージェントの権限"
  - "セキュリティ [SQL Server レプリケーション], エージェント セキュリティ モデル"
  - "ログ リーダー エージェント, セキュリティ"
  - "キュー リーダー エージェント, セキュリティ"
  - "マージ エージェント, セキュリティ"
  - "レプリケーション [SQL Server], エージェントおよびプロファイル"
ms.assetid: 6d09fc8d-843a-4a7a-9812-f093d99d8192
caps.latest.revision: 72
author: "BYHAM"
ms.author: "rickbyh"
manager: "jhubbard"
caps.handback.revision: 72
---
# レプリケーション エージェントのセキュリティ モデル
  レプリケーション エージェントのセキュリティ モデルを使用すると、レプリケーション エージェントを実行して接続するアカウントをきめ細かく制御できます。エージェントごとに異なるアカウントを指定できます。 アカウントを指定する方法の詳細については、次を参照してください。 [レプリケーションの管理のログインとパスワード](../../../relational-databases/replication/security/manage-logins-and-passwords-in-replication.md)します。  
  
> [!IMPORTANT]  
>  **sysadmin** 固定サーバー ロールのメンバーがレプリケーションを構成する際には、 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] エージェント アカウントの権限を借用するようにレプリケーション エージェントを構成できます。 このとき、レプリケーション エージェントのログインとパスワードを指定する必要はありませんが、その方法はお勧めしません。 セキュリティ上、このトピックの「エージェントに必要な権限」に記載されている最小限の権限を持った各エージェントのアカウントを指定することをお勧めします。  
  
 レプリケーション エージェントは、他の実行可能プログラムと同様に、Windows アカウントのコンテキストで実行されます。 このアカウントを使用して、Windows 統合セキュリティ接続が作成されます。 エージェントを実行するアカウントは、エージェントの開始方法で決まります。  
  
-   [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] エージェント ジョブからエージェントを開始する (既定) : [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] エージェント ジョブを使用してレプリケーション エージェントを開始すると、エージェントはレプリケーションを構成するときに指定したアカウントのコンテキストで実行されます。 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] エージェントおよびレプリケーションの詳細については、このトピックの「SQL Server エージェントのエージェント セキュリティ」を参照してください。 については、アクセスを許可するアカウントに必要な [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] エージェントを実行しを参照してください [SQL Server エージェントの構成](../../../ssms/agent/configure-sql-server-agent.md)します。  
  
-   MS-DOS コマンド ラインから直接、またはスクリプトによってエージェントを開始する : エージェントは、コマンド ラインでエージェントを実行しているユーザーのアカウントのコンテキストで実行されます。  
  
-   レプリケーション管理オブジェクト (RMO) を使用するアプリケーションまたは ActiveX コントロールからエージェントを開始する : エージェントは、RMO を呼び出しているアプリケーションまたは ActiveX コントロールのコンテキストで実行されます。  
  
    > [!NOTE]  
    >  ActiveX コントロールは推奨されません。  
  
 Windows 統合セキュリティのコンテキストで接続することをお勧めします。 また、旧バージョンとの互換性のために [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] セキュリティを使用できます。 推奨事項の詳細については、「 [Replication Security Best Practices](../../../relational-databases/replication/security/replication-security-best-practices.md)」を参照してください。  
  
## エージェントに必要な権限  
 エージェントを実行して接続するアカウントには、さまざまな権限が必要です。 これらの権限を次の表に詳しく示します。 各エージェントは異なる Windows アカウントで実行することをお勧めします。また、このアカウントには、必要な権限のみ許可してください。 エージェントの数に関連するでは、パブリケーション アクセス リスト (PAL) に関する情報を参照してください。 [パブリッシャーのセキュリティ保護](../../../relational-databases/replication/security/secure-the-publisher.md)します。  
  
> [!NOTE]  
>  特定の Windows オペレーティング システム内のユーザー アカウント制御 (UAC) により、スナップショット共有への管理アクセスが妨害される場合があります。 このため、スナップショット エージェント、ディストリビューション エージェント、およびマージ エージェントによって使用される Windows アカウントに、スナップショット共有の権限を明示的に与える必要があります。 この操作は、Windows アカウントが Administrators グループのメンバーである場合にも必要です。 詳細については、次を参照してください。 [スナップショット フォルダーをセキュリティで保護された](../../../relational-databases/replication/security/secure-the-snapshot-folder.md)します。  
  
|エージェント|アクセス許可|  
|-----------|-----------------|  
|スナップショット エージェント|このエージェントを実行する Windows アカウントは、ディストリビューターに接続するときに使用されます。 このアカウントは、次の条件を満たしている必要があります。<br /><br /> 最小のメンバーである、 **db_owner** ディストリビューション データベースの固定データベース ロール。<br /><br /> - スナップショット共有に対する読み取り、書き込み、変更権限がある。<br /><br /> <br /><br /> アカウントに対応できるようにするために使用に注意してください *接続* パブリッシャーにする必要がありますとものメンバーである、 **db_owner** パブリケーション データベースの固定データベース ロール。|  
|ログ リーダー エージェント (Log Reader Agent)|このエージェントを実行する Windows アカウントは、ディストリビューターに接続するときに使用されます。 このアカウントには少なくともメンバーであるは **db_owner** ディストリビューション データベースの固定データベース ロール。<br /><br /> パブリッシャーへの接続に使用されるアカウントには少なくともメンバーであるは **db_owner** パブリケーション データベースの固定データベース ロール。<br /><br /> 選択すると、 **sync_type** オプション *レプリケーションのサポートのみ*, 、*バックアップを使用して初期化*, 、または *lsn からの初期化*, を実行した後、ログ リーダー エージェントを実行する必要があります **sp_addsubscription**, 、スクリプトの設定がディストリビューション データベースに書き込まれるようにします。 ログ リーダー エージェントが、 **sysadmin** 固定サーバー ロールのメンバーであるアカウントで実行されている必要があります。 ときに、 **sync_type** にオプションが設定されている *自動*, 、特別なログ リーダー エージェントの操作は必要ありません。|  
|プッシュ サブスクリプションのディストリビューション エージェント|このエージェントを実行する Windows アカウントは、ディストリビューターに接続するときに使用されます。 このアカウントは、次の条件を満たしている必要があります。<br /><br /> -最最小のメンバーである、 **db_owner** ディストリビューション データベースの固定データベース ロール。<br /><br /> - PAL のメンバーである。<br /><br /> - スナップショット共有に対する読み取り権限を持っている。<br /><br /> - サブスクリプションが SQL Server 以外のサブスクライバー用の場合、サブスクライバーの OLE DB プロバイダーのインストール ディレクトリに対する読み取り権限を持っている。<br /><br /> -LOB データをレプリケートするときにディストリビューション エージェント書き込み権限が必要で、レプリケーション **C:\Program files \microsoft SQL Server\XX\COMfolder** XX、instanceID を表します。<br /><br /> <br /><br /> アカウントに対応できるようにするために使用に注意してください *接続* サブスクライバーにする必要がありますとものメンバーである、 **db_owner** サブスクリプション データベースの固定データベース ロールまたは同等のアクセス許可がある場合、サブスクリプションに対して、SQL Server 以外のサブスクライバー。<br /><br /> 使用する場合にも注意を `-subscriptionstreams >= 2` も付与する必要があります、ディストリビューション エージェントで、 **View Server State** デッドロックを検出するために、サブスクライバーのアクセス許可。|  
|プル サブスクリプションのディストリビューション エージェント|このエージェントを実行する Windows アカウントは、サブスクライバーに接続するときに使用されます。 このアカウントには少なくともメンバーであるは **db_owner** サブスクリプション データベースの固定データベース ロール。 ディストリビューターへの接続に使用されるアカウントは、次の条件を満たしている必要があります。<br /><br /> - PAL のメンバーである。<br /><br /> - スナップショット共有に対する読み取り権限を持っている。<br /><br /> -LOB データをレプリケートするときにディストリビューション エージェント書き込み権限が必要で、レプリケーション **C:\Program files \microsoft SQL Server\XX\COMfolder** XX、instanceID を表します。<br /><br /> <br /><br /> 使用する場合 `-subscriptionstreams >= 2` も付与する必要があります、ディストリビューション エージェントで、 **View Server State** デッドロックを検出するために、サブスクライバーのアクセス許可。|  
|プッシュ サブスクリプションのマージ エージェント|このエージェントを実行する Windows アカウントは、パブリッシャーおよびディストリビューターに接続するときに使用されます。 このアカウントは、次の条件を満たしている必要があります。<br /><br /> -最最小のメンバーである、 **db_owner** ディストリビューション データベースの固定データベース ロール。<br /><br /> - PAL のメンバーである。<br /><br /> - パブリケーション データベースのユーザーに関連付けられたログインである。<br /><br /> - スナップショット共有に対する読み取り権限を持っている。<br /><br /> <br /><br /> アカウントに使用するノート *接続* サブスクライバーにする必要がありますとものメンバーである、 **db_owner** サブスクリプション データベースの固定データベース ロール。|  
|プル サブスクリプションのマージ エージェント|このエージェントを実行する Windows アカウントは、サブスクライバーに接続するときに使用されます。 このアカウントには少なくともメンバーであるは **db_owner** サブスクリプション データベースの固定データベース ロール。 パブリッシャーおよびディストリビューターへの接続に使用されるアカウントは、次の条件を満たしている必要があります。<br /><br /> - PAL のメンバーである。<br /><br /> - パブリケーション データベースのユーザーに関連付けられたログインである。<br /><br /> - ディストリビューション データベース内のユーザーに関連付けられたログインである。 **Guest** ユーザーでもかまいません。<br /><br /> - スナップショット共有に対する読み取り権限を持っている。|  
|キュー リーダー エージェント (Queue Reader Agent)|このエージェントを実行する Windows アカウントは、ディストリビューターに接続するときに使用されます。 このアカウントには少なくともメンバーであるは **db_owner** ディストリビューション データベースの固定データベース ロール。<br /><br /> パブリッシャーへの接続に使用されるアカウントには少なくともメンバーであるは **db_owner** パブリケーション データベースの固定データベース ロール。<br /><br /> サブスクライバーへの接続に使用されるアカウントには少なくともメンバーであるは **db_owner** サブスクリプション データベースの固定データベース ロール。|  
  
## SQL Server エージェントのエージェント セキュリティ  
 [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)]、 [!INCLUDE[tsql](../../../includes/tsql-md.md)] プロシージャ、または RMO を使用してレプリケーションを構成すると、既定では各エージェントの [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] エージェント ジョブが作成されます。 その後エージェントは、連続実行、スケジュールを基にした実行、要求時実行にかかわらず、ジョブ ステップのコンテキストで実行されます。 これらのジョブは、 **の** [ジョブ] [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)]フォルダーで表示できます。 次の表にジョブ名の一覧を示します。  
  
|エージェント|ジョブ名|  
|-----------|--------------|  
|スナップショット エージェント|**\< パブリッシャー>-\< PublicationDatabase>-\< パブリケーション>-\< integer>**|  
|マージ パブリケーション パーティションに対するスナップショット エージェント|**Dyn_ \< パブリッシャー>-\< PublicationDatabase>-\< パブリケーション>-\< GUID>**|  
|ログ リーダー エージェント (Log Reader Agent)|**\< パブリッシャー>-\< PublicationDatabase>-\< integer>**|  
|プル サブスクリプションに対するマージ エージェント|**\< パブリッシャー>-\< PublicationDatabase>-\< パブリケーション>-\< サブスクライバー>-\< SubscriptionDatabase>-\< integer>**|  
|プッシュ サブスクリプションに対するマージ エージェント|**\< パブリッシャー>-\< PublicationDatabase>-\< パブリケーション>-\< サブスクライバー>-\< integer>**|  
|プッシュ サブスクリプションに対するディストリビューション エージェント|**\< パブリッシャー>-\< PublicationDatabase>-\< パブリケーション>-\< サブスクライバー>-\< integer>***|  
|プル サブスクリプションに対するディストリビューション エージェント|**\< パブリッシャー>-\< PublicationDatabase>-\< パブリケーション>-\< サブスクライバー>-\< SubscriptionDatabase>-\< GUID>***\*|  
|SQL Server 以外のサブスクライバーへのプッシュ サブスクリプションに対するディストリビューション エージェント|**\< パブリッシャー>-\< PublicationDatabase>-\< パブリケーション>-\< サブスクライバー>-\< integer>**|  
|キュー リーダー エージェント (Queue Reader Agent)|**[\< ディストリビューター>] です。\< 整数>**|  
  
 \*Oracle パブリケーションに対するプッシュ サブスクリプションの場合、ジョブ名は **\< パブリッシャー>-\< Publisher**> の代わりに **\< パブリッシャー>-\< PublicationDatabase>**します。  
  
 \*\*Oracle パブリケーションに対するプル サブスクリプションの場合、ジョブ名は **\< パブリッシャー>-\< DistributionDatabase**> の代わりに **\< パブリッシャー>-\< PublicationDatabase>**します。  
  
 レプリケーションの構成時には、エージェントを実行するアカウントを指定します。 しかし、すべてのジョブ ステップは *プロキシ*のセキュリティ コンテキストで実行されます。そのためレプリケーションでは、指定したエージェント アカウントに対して、以下のマッピングが内部的に実行されます。  
  
-   アカウントは、まず [!INCLUDE[tsql](../../../includes/tsql-md.md)] [CREATE CREDENTIAL](../../../t-sql/statements/create-credential-transact-sql.md) ステートメントを使用して資格情報にマップされます。 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] エージェント プロキシは、資格情報を使用して Windows ユーザー アカウントに関する情報を格納します。  
  
-    [Sp_add_proxy](../../../relational-databases/system-stored-procedures/sp-add-proxy-transact-sql.md) ストアド プロシージャを呼び出すし、資格情報を使用して、プロキシを作成する.  
  
> [!NOTE]  
>  この情報は、適切なセキュリティ コンテキストでエージェントを実行する作業についての理解を深めるために提供されています。 作成済みの資格情報またはプロキシは通常、直接操作する必要はありません。  
  
## 参照  
 [レプリケーション セキュリティの推奨事項](../../../relational-databases/replication/security/replication-security-best-practices.md)   
 [セキュリティと保護と #40 です。レプリケーションと #41 です。](../../../relational-databases/replication/security/security-and-protection-replication.md)   
 [スナップショット フォルダーのセキュリティ保護](../../../relational-databases/replication/security/secure-the-snapshot-folder.md)  
  
  