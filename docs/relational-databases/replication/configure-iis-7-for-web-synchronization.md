---
title: "Web 同期用の IIS 7 の構成 | Microsoft Docs"
ms.custom: ""
ms.date: "09/12/2016"
ms.prod: "sql-server-2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "replication"
ms.tgt_pltfrm: ""
ms.topic: "article"
helpviewer_keywords: 
  - "IIS 7 サーバーの構成 [SQL Server レプリケーション]"
  - "Web 同期、IIS 7 サーバー"
ms.assetid: c201fe2c-0a76-44e5-a233-05e14cd224a6
caps.latest.revision: 11
author: "BYHAM"
ms.author: "rickbyh"
manager: "jhubbard"
caps.handback.revision: 11
---
# Web 同期用の IIS 7 の構成
[!INCLUDE[tsql-appliesto-ss2008-xxxx-xxxx-xxx_md](../../includes/tsql-appliesto-ss2008-xxxx-xxxx-xxx-md.md)]

  このトピックの手順のガイドを手動で構成の手順に従って [!INCLUDE[msCoName](../../includes/msconame-md.md)] マージ レプリケーションの Web 同期でインターネット インフォメーション サービス (IIS) 7 以降のバージョンを使用します。 
  
 IIS 7 以降の構成は、Web 同期を有効にするために必要な 3 つの手順の最初です。  
  
 構成プロセス全体の概要については、次を参照してください。 [Web 同期の構成](../../relational-databases/replication/configure-web-synchronization.md)します。  
  
> [!IMPORTANT]  
>  アプリケーションで [!INCLUDE[dnprdnlong](../../includes/dnprdnlong-md.md)] 以降のバージョンのみが使用されることと、 [!INCLUDE[dnprdnshort](../../includes/dnprdnshort-md.md)] の以前のバージョンが IIS サーバーにインストールされていないことを確認します。 以前のバージョンの [!INCLUDE[dnprdnshort](../../includes/dnprdnshort-md.md)] があると、エラーが発生する可能性があります。たとえば、"Web 同期中のメッセージの形式が無効でした。 Web サーバーでレプリケーション コンポーネントが正しく構成されていることを確認してください。" というエラーなどです。  
  
 Web 同期を使用するには、次の手順を完了して IIS を構成する必要があります。 ここでは、各手順を詳しく説明します。  
  
1.  IIS を実行しているコンピューターに [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] レプリケーション リスナーをインストールして構成します。  
  
2.  SSL (Secure Sockets Layer) を構成します。 IIS とすべてのサブスクライバー間の通信には SSL が必要です。  
  
3.  IIS 認証を構成します。  
  
4.  アカウントを構成し、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] レプリケーション リスナーの権限を設定します。  
  
## SQL Server レプリケーション リスナーのインストール  

Web 同期は、バージョン 5.0 以降では、IIS でサポートされます。 構成する Web 同期ウィザードの IIS バージョン 5 および 6 では、IIS バージョン 7.0 以降で使用できません。 **IIS サーバーに web 同期コンポーネントを使用して、SQL Server 2012 以降のレプリケーション、SQL Server をインストールする必要があります。 無料の SQL Server Express エディションを指定できます。**
  
#### SQL Server レプリケーション リスナーのインストールと構成を行うには  
  
1.  IIS コンピューターに SQL Server レプリケーションをインストールします。

2. IIS を実行しているコンピューターに、replisapi.dll 用の新しいファイル ディレクトリを作成します。 ディレクトリを作成するには、下のディレクトリを作成することをお勧めするは、どこに、\<*ドライブ*>: \Inetpub ディレクトリ。 たとえば、ディレクトリを作成 \<*ドライブ*>: \Inetpub\SQLReplication\\します。  
  
3.  ディレクトリから replisapi.dll をコピー [!INCLUDE[ssInstallPathVar](../../includes/ssinstallpathvar-md.md)]手順 1. で作成したファイルのディレクトリへの com \ です。  
  
4.  次の手順に従って replisapi.dll を登録します。  
  
    1.  クリックして **開始**, 、順にクリック **実行**します。  **開いている** ボックスに、入力 **cmd**, 、順にクリック **OK**します。  
  
    2.  手順 1. で作成したディレクトリで、次のコマンドを実行します。  
  
         **regsvr32 replisapi.dll**  
  
5.  レプリケーション用の新しい Web サイトを作成するか、既存のサイトを使用します。 この Web サイトは、同期の際にレプリケーション コンポーネントからアクセスされます。 ここでは、既定の Web サイトを使用すると仮定します。 Web サイトを作成する方法の詳細については、IIS のマニュアルを参照してください。  
  
6.  IIS で仮想ディレクトリを作成します。 仮想ディレクトリは、手順 4. で作成した Web サイトの下に作成し、手順 1. で作成したディレクトリにマッピングします。 このディレクトリに割り当てる権限は最小限にしてください。 少なくともを選択する必要があります **読み取り** と **Execute** アクセス許可。  
  
    1.   **インターネット インフォメーション サービス (IIS) マネージャー**, で、 **接続** ] ウィンドウで、右クリックし **既定の Web サイト**, 、し、[ **仮想ディレクトリの追加**します。  
  
    2.   **エイリアス**, 、入力 **SQLReplication**します。  
  
    3.   **物理パス**, 、入力 **\< ドライブ>: \Inetpub\SQLReplication\\**, 、] をクリックし、 **[ok]**します。  
  
7.  replisapi.dll を実行できるように IIS を構成します。  
  
    1.   **インターネット インフォメーション サービス (IIS) マネージャー**, 、クリックして **既定の Web サイト**します。  
  
    2.  中央のウィンドウで、クリックして **ハンドラー マッピング**します。  
  
    3.   **アクション** ] ウィンドウで、をクリックして **[モジュール マップの**です。  
  
    4.   **要求** パスを入力 **replisapi.dll**します。  
  
    5.   **モジュール** ドロップダウン リストで、 **IsapiModule**します。  
  
    6.   **実行可能ファイル**, 、入力 **\< ドライブ>: \Inetpub\SQLReplication\replisapi.dll**します。  
  
    7.   **名前**, 、入力 **Replisapi**します。  
  
    8.  クリックして、 **要求の制限** ボタンをクリックし、 **アクセス** タブをクリックし、をクリックして **Execute**します。  
  
    9. をクリックして **OK** を閉じる、 **要求の制限** クリックしてダイアログ ボックスで、 **[ok]** を閉じます、 **[モジュール マップの** ] ダイアログ ボックス。 ISAPI 拡張を許可するメッセージが表示されたら、クリックして **はい** 、拡張機能を追加します。  
  
    10. Replisapi.dll が下に表示されることを確認、 **有効** ハンドラー マッピングします。 ある場合、 **無効になっている** を一覧表示、Replisapi のエントリを右クリックし、クリックして **機能のアクセス許可の編集**します。 チェック、 **Execute** ボックスをクリックして **OK**します。  
  
## IIS 認証の構成  
 サブスクライバーのコンピューターが IIS に接続するには、サブスクライバーがリソースやプロセスにアクセスする前に、IIS がサブスクライバーを認証する必要があります。 認証は、Web サイト全体または作成した特定の仮想ディレクトリに適用することができます。  
  
 基本認証と SSL を組み合わせて使用することをお勧めします。 使用する認証の種類にかかわらず、SSL は必須です。  
  
 基本認証と SSL を組み合わせて使用することをお勧めします。 使用する認証の種類にかかわらず、SSL は必須です。  
  
#### IIS 認証を構成するには  
  
1.   **インターネット インフォメーション サービス (IIS) マネージャー**, 、クリックして **既定の Web サイト**します。  
  
2.  中央のウィンドウでダブルクリック **認証**します。  
  
3.  [匿名認証] を右クリックし、[無効にする] をクリックします。  
  
4.  [基本認証] を右クリックし、[有効にする] をクリックします。  
  
## Secure Sockets Layer の構成  
 SSL を構成するには、IIS を実行しているコンピューターが使用する証明書を指定する必要があります。 マージ レプリケーション用の Web 同期では、サーバー証明書のみがサポートされており、クライアント証明書はサポートされていません。 配置用に IIS を構成するには、最初に証明機関 (CA) から証明書を取得する必要があります。 証明書の詳細については、IIS のマニュアルを参照してください。  
  
 証明書をインストールしたら、その証明書を Web 同期で使用する Web サイトと関連付ける必要があります。 開発やテストでは、自己署名証明書を指定できます。 この場合、IIS 7 で証明書を作成してコンピューターに登録できます。  
  
 ここで紹介する手順と運用環境に配置する場合の手順との違いは、運用環境や運用前テストの環境では、自己署名証明書ではなく、CA によって発行された証明書を使用することです。  
  
> [!IMPORTANT]  
>  運用環境で自己署名証明書を使用することは推奨されません。 自己署名証明書は安全ではありません。 自己署名証明書を使用するのは、開発およびテストのときだけにしてください。  
  
 SSL を構成するには、次の手順を実行します。  
  
1.  SSL を要求し、クライアント証明書を無視するように Web サイトを構成します。  
  
2.  CA から証明書を取得するか、自己署名証明書を作成します。  
  
3.  証明書をレプリケーション Web サイトにバインドします。  
  
#### Web サイトの SSL セキュリティを要求するには  
  
1.   **インターネット インフォメーション サービス (IIS) マネージャー**, をローカル サーバー] ノードを展開して、クリックして、 **既定の Web サイト** (または、Web 同期サイトが既定の Web サイトと異なる場合)。  
  
2.  中央のウィンドウでダブルクリック **SSL 設定**します。  
  
3.  チェック、 **SSL** オプション。  **クライアント証明書**, 、いることを確認、 **無視** ボタンが選択されています。  
  
#### テスト用の自己署名証明書を作成するには  
  
1.   **インターネット インフォメーション サービス (IIS) マネージャー**, 、ローカル サーバーのノードをクリックし、中央のペインでの [でダブルクリック **サーバー証明書**します。  
  
2.   **アクション** ] ウィンドウで、をクリックして **自己署名証明書の作成**します。  
  
3.   **自己署名証明書の作成** ] ダイアログ ボックスで、証明書の名前を入力し、をクリックして **OK**します。  
  
###### 証明書を Web サイトにバインドするには  
  
1.   **接続** ] ウィンドウで、をクリックして、 **既定の Web サイト** (または、Web 同期サイトが既定の Web サイトと異なる場合)。  
  
2.   **アクション** ] ウィンドウで、をクリックして **バインド**, 、] をクリックし、 **追加**します。  **サイト バインドの追加** ] ダイアログ ボックスが表示されます。  
  
3.   **型** ドロップダウン リストで、 **https**します。 既定の設定のままにして **IP アドレス** と **ポート**します。  
  
4.   **SSL 証明書** ドロップダウン リストで、[証明書は、「テストは、自己署名証明書を作成するには」で作成] をクリック **OK**, 、] をクリックし、 **閉じる**します。  
  
###### 証明書をテストするには  
  
1.   **インターネット インフォメーション サービス (IIS) マネージャー**, 、クリックして **既定の Web サイトです。**  
  
2.   **アクション** ] ウィンドウで、をクリックして **参照 \*: 443(https)**します。  
  
3.  Internet Explorer が開き、"この Web サイトのセキュリティ証明書には問題があります" というメッセージが表示されます。 これは、関連付けられている証明書が既知の CA によって発行された証明書ではないために信頼できないことを通知する警告です。 これは予期される警告で、クリックして **(非推奨) このサイトの閲覧を続行する**です。  
  
4.  メッセージが表示されたら **localhost に接続する**, 、ユーザー名とパスワードを入力します。 これで、Web サイトの既定のページが表示されます。  
  
## SQL Server レプリケーション リスナーの権限の設定  
 サブスクライバーのコンピューターが IIS を実行しているコンピューターに接続するときは、IIS の構成時に指定した認証の種類を使用して、サブスクライバーが認証されます。 IIS はサブスクライバーを認証した後、サブスクライバーに [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] レプリケーションを実行する権限があるかどうかを確認します。 replisapi.dll の権限を設定して、 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] レプリケーションを実行できるユーザーを制御します。 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] レプリケーションに許可なくアクセスされることがないように権限を正しく構成する必要があります。  
  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] レプリケーション リスナーの実行に使用するアカウントを最小の権限で構成するには、次の手順を完了する必要があります。 以下の手順は、IIS 7.0 を実行する [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows Server 2008 に適用されます。  
  
 次の手順の他に、PAL (パブリケーション アクセス リスト) に必要なログインが登録されていることを確認してください。 PAL の詳細については、次を参照してください。 [パブリッシャーのセキュリティ保護](../../relational-databases/replication/security/secure-the-publisher.md)します。  
  
 **重要な** このセクションで作成したアカウントは、同期中に、パブリッシャーとディストリビューターに接続するアカウント。 したがって、ディストリビューション サーバーとパブリケーション サーバーに SQL ログイン アカウントとして追加する必要があります。  
  
 SQL Server レプリケーション リスナーに使用するアカウントには、「マージ エージェント セキュリティ」の「パブリッシャーまたはディストリビューターへの接続」で説明されている権限が必要です。  
  
 このアカウントに必要な権限の概要を以下に示します。  
  
-   パブリケーション アクセス リスト (PAL) のメンバーである。  
  
-   パブリケーション データベースのユーザーに関連付けられたログインにマップされている。  
  
-   ディストリビューション データベース内のユーザーに関連付けられているログインにマップされている。  
  
-   スナップショット共有の読み取り権限を持つ。  
  
#### アカウントと権限を構成するには  
  
1.  IIS を実行しているコンピューターでローカル アカウントを作成します。  
  
    1.  開いている **サーバー マネージャー**します。 [スタート] メニューを右クリックして **コンピューター**, 、クリックして **管理**します。  
  
    2.   **サーバー マネージャー**, 、展開 **構成**, 、順に展開 **ローカル ユーザーとグループ**します。  
  
    3.  右クリック **ユーザー**, 、クリックして **新しいユーザー**します。  
  
    4.  ユーザー名と複雑なパスワードを入力します。 クリア **ユーザーは次回ログオン時にパスワードを変更する必要があります**します。  
  
    5.  クリックして **作成**, 、順にクリック **閉じる**します。  
  
2.  アカウントを IIS_IUSRS グループに追加します。  
  
    1.   **サーバー マネージャー**, 、展開 **構成**, 、展開 **ローカル ユーザーとグループ**, 、] をクリックし、 **グループ**します。  
  
    2.  右クリック **IIS_IUSRS**, 、クリックして **グループに追加**します。  
  
    3.   **IIS_IUSRS のプロパティ** ] ダイアログ ボックスをクリックして **追加**します。  
  
    4.   **[ユーザー、コンピューター、またはグループ** ] ダイアログ ボックスで、手順 1. で作成したアカウントを追加します。  
  
    5.  いることを確認 **この場所から** 、ローカル コンピューター (ドメインではなく) の名前を表示します。 このフィールドに、ローカル コンピューター名が表示されない場合はクリックして **場所**します。  **場所** ] ダイアログ ボックスでは、ローカル コンピューターを選択し、クリックして **OK**します。  
  
    6.   **ユーザーの選択** ] ダイアログ ボックスおよび **IIS_IUSRS のプロパティ** ダイアログ ボックスで、をクリックして**[ok]**します。  
  
3.  replisapi.dll が保存されているフォルダーに対する最小限の権限をアカウントに許可します。  
  
    1.  Windows エクスプ ローラーで、replisapi.dll 用に作成したフォルダーを右クリックし、をクリックして **プロパティ**します。  
  
    2.  **[セキュリティ]** タブで、**[編集]** をクリックします。  
  
    3.   **のアクセス許可 \< フォルダー名>** ダイアログ ボックスで、をクリックして **追加** 手順 1. で作成したアカウントを追加します。  
  
    4.  いることを確認 **この場所から** 、ローカル コンピューター (ドメインではなく) の名前を表示します。 このフィールドに、ローカル コンピューター名が表示されない場合はクリックして **場所**します。  **場所** ] ダイアログ ボックスでは、ローカル コンピューターを選択し、クリックして **OK**します。  
  
    5.  アカウントは、のみが許可されていることを確認 **読み取り**, 、**読み取りと実行**, 、および **フォルダー内容の一覧** アクセス許可。  
  
    6.  [ユーザーまたはグループ、ディレクトリへのアクセスを必要としない] をクリックして **削除**, 、] をクリックし、 **[ok]**します。  
  
4.  アプリケーション プールを作成 **インターネット インフォメーション サービス (IIS) マネージャー**:  
  
    1.   **インターネット インフォメーション サービス (IIS) マネージャー**, で、 **接続** ] ウィンドウで、ローカル サーバー ノードを展開します。  
  
    2.  右クリック **アプリケーション プール**, 、クリックして **アプリケーション プールの追加**します。  
  
    3.  アプリケーション プールの名前を入力をその他のフィールドの既定値のままにしてクリックして **OK**します。  
  
    > [!NOTE]  
    >  3 つ以上の同期クライアントが同時に実行される可能性がある場合は、Web ガーデンを作成できます。 詳細については、「Web ガーデンの作成」を参照してください [Web 同期の構成](../../relational-databases/replication/configure-web-synchronization.md)します。  
  
5.  アカウントとアプリケーション プールを関連付けます。  
  
    1.   **インターネット インフォメーション サービス (IIS) マネージャー**, ローカル サーバー] ノードを展開しをクリックし、 **アプリケーション プール**します。  
  
    2.  アプリケーション プール] をクリックし、作成したを右クリックして **アプリケーション プールの既定値を設定**します。  
  
    3.   **アプリケーション プールの既定値** ダイアログ ボックスで、下へスクロールして、 **プロセス モデル** セクションは、クリックして、 **Identity** フィールドです。  
  
    4.  右側にある省略記号ボタンをクリックして、 **Identity** 行です。  
  
    5.  クリックして、 **カスタム アカウント** ボタンをクリックし、をクリックし、 **設定**します。  
  
    6.   **ユーザー名** と **パスワード** フィールドがアカウントと、手順 1 で作成したパスワードを入力し、クリックして **OK**します。  
  
    7.  をクリックして **OK** を閉じる、 **アプリケーション プール Id** クリックしてダイアログ ボックスで、 **[ok]** を閉じます、 **アプリケーション プールの既定値**] ダイアログ ボックス。  
  
6.  アプリケーション プールとレプリケーション Web サイトを関連付けます。  
  
    1.   **インターネット インフォメーション サービス (IIS) マネージャー**, ローカル サーバー] ノードを展開しをクリックし、 **既定の Web サイト** (または、Web 同期サイトが既定の Web サイトと異なる場合)。  
  
    2.   **アクション** ] ウィンドウで、 **Web サイトの管理**, 、] をクリックして **の詳細設定**します。  
  
    3.   **の詳細設定** ] ダイアログ ボックスの右側にある省略記号ボタンをクリック **アプリケーション プール**します。  
  
    4.   **アプリケーション プール** ドロップダウン リストが、手順 4. で作成したアプリケーション プールを選択し、クリックして **OK**します。  
  
    5.  をクリックして **OK** の詳細設定を閉じます。  
  
## replisapi.dll への接続のテスト  
 IIS を実行しているコンピューターへの接続をテストし、Secure Sockets Layer (SSL) 証明書が正しくインストールされているかどうかを確認する診断モードでは、Web 同期を実行します。 診断モードで Web 同期を実行するには、IIS を実行しているコンピューターの管理者である必要があります。  
  
#### replisapi.dll への接続をテストするには  
  
1.  サブスクライバーの LAN (ローカル エリア ネットワーク) が正しく設定されていることを確認します。  
  
    1.   [!INCLUDE[msCoName](../../includes/msconame-md.md)] Internet Explorer で、 **ツール** ] メニューのをクリックして **インターネット オプション**します。  
  
    2.   **接続** ] タブ、[ **LAN の設定**します。  
  
    3.  LAN にプロキシ サーバーを使用しない場合は、オフ **設定を自動的に検出** と **LAN にプロキシ サーバーを使用する**です。  
  
    4.  プロキシ サーバーを使用する場合はクリックして **LAN にプロキシ サーバーを使用する** と **ローカル アドレスに対してプロキシ サーバーを使用しない**, 、] をクリックし、 **[ok]**します。  
  
2.  サブスクライバー側の Internet Explorer から診断モードでサーバーに接続します。診断モードで接続するには、replisapi.dll のアドレスの後に「 `?diag` 」を追加します。 例: **https://server.domain.com/directory/replisapi.dll?diag**します。  
  
    > [!NOTE]  
    >  上記の例で **server.domain.com** 、完全に置き換える必要が **発行先** 名の下に一覧表示、 **サーバー証明書** IIS マネージャーでのセクションです。  
  
3.  IIS に指定した証明書は、Windows オペレーティング システムによって認識されない場合、 **セキュリティの警告** ] ダイアログ ボックスが表示されます。 証明書がテスト用の証明書であるか、Windows が認識しない証明機関 (CA) によって発行されていると、この警告が表示されます。  
  
    > [!NOTE]  
    >  このダイアログ ボックスが表示されない場合は、アクセスしているサーバーの証明書が信頼された証明書としてサブスクライバーの証明書ストアに追加されていることが確認されます。 証明書のエクスポートの詳細については、IIS のマニュアルを参照してください。  
  
    1.   **セキュリティの警告** ] ダイアログ ボックスをクリックして **証明書の表示**します。  
  
    2.   **証明書** ] ダイアログ ボックスの [、 **全般** ] タブ、[ **証明書のインストール**します。  
  
    3.  証明書インポート ウィザードを実行します。このウィザードでは既定の値をそのまま使用します。  
  
    4.   **セキュリティの警告** ダイアログ ボックスで、をクリックして **はい**します。  
  
    5.  証明書インポート ウィザードの確認] ダイアログ ボックス [ **OK**します。  
  
    6.  閉じる、 **証明書** ] ダイアログ ボックス。  
  
    7.   **セキュリティの警告** ダイアログ ボックスで、をクリックして **はい**します。  
  
    > [!NOTE]  
    >  ユーザーの証明書がインストールされます。 IIS と同期するユーザーすべてに対してこの手順を実行する必要があります。  
  
4.   **への接続 \< ServerName>** ] ダイアログ ボックスで、ログインと、マージ エージェントが IIS への接続に使用するパスワードを指定します。 これらの資格情報は、サブスクリプションの新規作成ウィザードで指定することもできます。  
  
5.  Internet Explorer ウィンドウで次のように呼び出されます。 **SQL web 同期診断情報**, 、いることを確認の各値 **ステータス** ] ページで列が **成功**します。  
  
6.  証明書がサブスクライバーに正しくインストールされていることを確認します。  
  
    1.  Internet Explorer をいったん閉じてから、再度開きます。  
  
    2.  サーバーに診断モードで接続します。 証明書が正常にインストールされている場合、 **セキュリティの警告** ] ダイアログ ボックスが表示されません。 ダイアログ ボックスが表示される場合は、マージ エージェントから IIS を実行しているコンピューターへの接続に失敗します。 アクセスしているサーバーの証明書が、信頼された証明書としてサブスクライバーの証明書ストアに追加されていることを確認する必要があります。 証明書のエクスポートの詳細については、IIS のマニュアルを参照してください。  
  
## 参照  
 [マージ レプリケーションの Web 同期](../../relational-databases/replication/web-synchronization-for-merge-replication.md)   
 [Web 同期を構成します。](../../relational-databases/replication/configure-web-synchronization.md)  
  
  