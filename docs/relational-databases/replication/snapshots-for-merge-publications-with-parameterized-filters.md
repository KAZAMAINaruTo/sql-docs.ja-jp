---
title: "パラメーター化されたフィルターを使用したマージ パブリケーションのスナップショット | Microsoft Docs"
ms.custom: ""
ms.date: "03/14/2017"
ms.prod: "sql-server-2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "replication"
ms.tgt_pltfrm: ""
ms.topic: "article"
helpviewer_keywords: 
  - "パラメーター化されたフィルター [SQL Server レプリケーション]、スナップショット"
  - "スナップショット [SQL Server レプリケーション]、パラメーター化されたフィルターおよび"
  - "フィルター [SQL Server レプリケーション]、パラメーター化"
  - "マージ レプリケーション [SQL Server レプリケーション]、サブスクリプションの初期化"
  - "サブスクリプションの初期化 [SQL Server レプリケーション], スナップショット"
ms.assetid: 99d7ae15-5457-4ad4-886b-19c17371f72c
caps.latest.revision: 37
author: "BYHAM"
ms.author: "rickbyh"
manager: "jhubbard"
caps.handback.revision: 37
---
# パラメーター化されたフィルターを使用したマージ パブリケーションのスナップショット
  パラメーター化された行フィルターがマージ パブリケーションで使用される場合、レプリケーションは 2 つの要素から成るスナップショットを持つ各サブスクリプションを初期化します。 まず、レプリケーションに必要なすべてのオブジェクトとパブリッシュされたオブジェクトのスキーマが含まれるスキーマ スナップショットが作成されます。ただしデータは含まれません。 次に、スキーマ スナップショットからのオブジェクトとスキーマが含まれるスナップショットと、サブスクリプションのパーティションに属するデータを使用して、各サブスクリプションが初期化されます。 複数のサブスクリプションが特定のパーティションを受信する場合 (つまり、同じスキーマとデータを受信する場合)、そのパーティションのスナップショットは 1 回しか作成されません。複数のサブスクリプションは、同じスナップショットから初期化されます。 パラメーター化された行フィルターの詳細については、次を参照してください。 [パラメーター化された行フィルター](../../relational-databases/replication/merge/parameterized-row-filters.md)します。  
  
 次の 3 つの方法のいずれかで、パラメーター化されたフィルターを使用して、パブリケーションのスナップショットを作成できます。  
  
-   各パーティションのスナップショットを事前に生成します。 このオプションを使用すると、スナップショットが生成されたときに制御できます。  
  
     スナップショットがスケジュールに従って更新されるように選択することもできます。 スナップショットの作成対象となったパーティションをサブスクライブする新しいサブスクライバーは、最新のスナップショットを受信します。  
  
-   サブスクライバーが初めて同期されたときに、スナップショットの生成と適用を要求できるようにします。 このオプションを使用すると、新しいサブスクライバーは管理者の介入を必要としないで同期できます (スナップショットを生成するには [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] エージェントがパブリッシャーで実行されている必要があります)。  
  
    > [!NOTE]  
    >  パブリケーション内の 1 つ以上のアーティクルにフィルターを適用して、各サブスクリプション固有の重複しないパーティションが得られる場合、マージ エージェントが実行されるたびにメタデータがクリーンアップされます。 これは、パーティション スナップショットの有効期間が短時間で切れてしまうことを意味します。 このオプションを使用する場合は、サブスクライバーに対してスナップショットの生成と配信を許可することを検討する必要があります。 フィルター オプションの詳細については、次を参照してください。 [パラメーター化された行フィルター](../../relational-databases/replication/merge/parameterized-row-filters.md)します。  
  
-   スナップショット エージェントを使用して、手動で各サブスクライバーのスナップショットを生成します。 サブスクライバーは、マージ エージェントが正しいスナップショットを取得および適用できるように、スナップショットの場所をマージ エージェントに提供する必要があります。  
  
    > [!NOTE]  
    >  このオプションは、旧バージョンとの互換性のためにサポートされており、FTP スナップショット共有を使用できません。  
  
 最も柔軟性の高い方法は、事前に生成され、サブスクライバーに要求されるスナップショット オプションの組み合わせを使用することです。スナップショットは、スケジュールに基づいて (通常はオフピーク時に) 事前生成および更新されますが、新しいパーティションを必要とするサブスクリプションが作成された場合は、サブスクライバーが独自のスナップショットを生成できます。  
  
 各店舗に在庫を配送する移動営業部署のある [!INCLUDE[ssSampleDBCoShort](../../includes/sssampledbcoshort-md.md)] について考えてみましょう。 各営業担当者は、各自のログインに基づいてサブスクリプションを受信し、各自が担当する店舗についてのデータを取得します。 管理者は、スナップショットを事前に生成し、毎週日曜日に更新するように選択しています。 場合によっては、新しいユーザーがシステムに追加され、スナップショットを使用できないパーティションのデータが必要になります。 管理者の選択により、サブスクライバーが開始するスナップショットで、スナップショットがまだ使用できないためにサブスクライバーがパブリケーションをサブスクライブできない状況を回避することもできます。 新しいサブスクライバーが初めて接続すると、指定されたパーティションに対してスナップショットが生成され、サブスクライバーで適用されます (スナップショットを生成できるようにするには、[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] エージェントがパブリッシャーで実行されている必要があります)。  
  
 パラメーター化されたフィルターには、パブリケーションのスナップショットを作成するを参照してください。 [パラメーター化されたフィルターを使用してマージ パブリケーションのスナップショットを作成](../../relational-databases/replication/create-a-snapshot-for-a-merge-publication-with-parameterized-filters.md)します。  
  
## スナップショット エージェントに対するセキュリティの設定  
 スナップショット エージェントは各パーティションのスナップショットを作成します。 事前に生成したスナップショットとサブスクライバーによって要求されるスナップショットは、エージェントの実行や、パブリケーションのスナップショット エージェント ジョブの作成時に指定された資格情報で接続を行う (パブリケーションの新規作成ウィザードで、ジョブを作成または **sp_addpublication_snapshot**)。 資格情報を変更するには使用 **sp_changedynamicsnapshot_job**します。 詳細については、次を参照してください。 [sp_changedynamicsnapshot_job & #40 です。Transact SQL と #41;](../../relational-databases/system-stored-procedures/sp-changedynamicsnapshot-job-transact-sql.md)します。  
  
## 参照  
 [スナップショットを使用したサブスクリプションの初期化](../../relational-databases/replication/initialize-a-subscription-with-a-snapshot.md)   
 [パラメーター化された行フィルター](../../relational-databases/replication/merge/parameterized-row-filters.md)   
 [スナップショット フォルダーのセキュリティ保護](../../relational-databases/replication/security/secure-the-snapshot-folder.md)  
  
  