---
title: "マージ レプリケーションのバックアップと復元の方式 | Microsoft Docs"
ms.custom: ""
ms.date: "03/14/2017"
ms.prod: "sql-server-2016"
ms.reviewer: ""
ms.suite: ""
ms.technology: 
  - "replication"
ms.tgt_pltfrm: ""
ms.topic: "article"
helpviewer_keywords: 
  - "復旧 [SQL Server レプリケーション], マージ レプリケーション"
  - "バックアップ [SQL Server レプリケーション], マージ レプリケーション"
  - "復元 [SQL Server レプリケーション], マージ レプリケーション"
  - "マージ レプリケーション [SQL Server レプリケーション], バックアップおよび復元"
ms.assetid: b8ae31c6-d76f-4dd7-8f46-17d023ca3eca
caps.latest.revision: 48
author: "BYHAM"
ms.author: "rickbyh"
manager: "jhubbard"
caps.handback.revision: 48
---
# マージ レプリケーションのバックアップと復元の方式
  マージ レプリケーションでは、次のデータベースを定期的にバックアップします。  
  
-   パブリッシャーにあるパブリケーション データベース  
  
-   ディストリビューターにあるディストリビューション データベース  
  
-   各サブスクライバーにあるサブスクリプション データベース  
  
-   パブリッシャー、ディストリビューター、およびすべてのサブスクライバーにある **master** および **msdb** システム データベース。 これらのデータベースは、相互に関連するレプリケーション データベースとして、同時にバックアップする必要があります。 たとえば、バックアップ、 **マスター** と **msdb** 同時に、パブリッシャー データベースにパブリケーション データベースをバックアップします。 場合は、パブリケーション データベースで復元されていることを確認、 **マスター** と **msdb** データベースはレプリケーションの構成と設定の観点からのパブリケーション データベースと一致します。  
  
 定期的なログ バックアップを実行する場合は、レプリケーション関連の変更をログ バックアップでキャプチャする必要があります。 ログ バックアップを実行しない場合は、レプリケーションに関連する設定を変更するたびに、バックアップを実行する必要があります。 詳細については、「 [Common Actions Requiring an Updated Backup](../../../relational-databases/replication/administration/common-actions-requiring-an-updated-backup.md)」を参照してください。  
  
 以下で詳しく説明するパブリケーション データベースのバックアップと復元の方法のいずれかを選択し、ディストリビューション データベースとサブスクリプション データベースに対する推奨事項に従ってください。  
  
## パブリケーション データベースのバックアップと復元  
 マージ パブリケーション データベースの復元方法は 2 とおりあります。 バックアップからパブリケーション データベースを復元した後に、次のいずれかを実行する必要があります。  
  
-   パブリケーション データベースとサブスクリプション データベースを同期する。  
  
-   パブリケーション データベースにあるパブリケーションへのすべてのサブスクリプションを再初期化する。  
  
 これらのいずれかの方法を使用すると、復元の実行後にパブリッシャーとすべてのサブスクライバーが同期されます。  
  
> [!NOTE]  
>  ID 列を含むテーブルを使用している場合は、復元後、正しい ID 範囲を割り当てる必要があります。 詳細については、次を参照してください。 [Id 列のレプリケート](../../../relational-databases/replication/publish/replicate-identity-columns.md)します。  
  
### パブリケーション データベースの同期  
 パブリケーション データベースとサブスクリプション データベースを同期すると、パブリケーション データベースで以前に変更され、復元されたバックアップに表示されていない変更を  1 つ以上のサブスクリプション データベースからアップロードできます。 アップロードできるデータは、パブリケーションのフィルター選択方法によって次のように異なります。  
  
-   パブリケーションがフィルター選択されていない場合は、最新のサブスクライバーと同期することでパブリケーション データベースを最新の状態に更新できます。  
  
-   パブリケーションがフィルター選択されている場合は、パブリケーションを最新の状態に更新できない場合があります。 たとえば、各サブスクリプションが 1 つの地域 (北、東、南、西のいずれか) の顧客データのみを受信できるようにパーティション分割されているテーブルがあるとします。 データの各パーティションに 1 つ以上のサブスクライバーがある場合、各パーティションのサブスクライバーと同期することにより、パブリケーション データベースを最新の状態に更新できます。 ただし、たとえば、西パーティションのデータがすべてのサブスクライバーにレプリケートされていない場合は、パブリッシャーでこのデータを最新の状態に更新することはできません。  
  
> [!IMPORTANT]  
>  パブリケーション データベースとサブスクリプション データベースを同期することによって、復元対象のパブリッシュされたテーブルを、バックアップから復元されたパブリッシュされていないテーブルよりも新しい状態にすることができます。  
  
 バージョンを実行しているサブスクライバーを同期するかどうかは [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] より前のバージョン [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], 、サブスクリプションを匿名にすることはできません。 それは、クライアント サブスクリプションまたはサーバー サブスクリプション (ローカル サブスクリプションと以前のリリースでのグローバル サブスクリプションと呼ばれる) である必要があります。  
  
 サブスクリプションを同期するを参照してください。 [プッシュ サブスクリプションを同期する](../../../relational-databases/replication/synchronize-a-push-subscription.md) と [プル サブスクリプションを同期する](../../../relational-databases/replication/synchronize-a-pull-subscription.md)です。  
  
### すべてのサブスクリプションの再初期化  
 すべてのサブスクリプションを再初期化すると、すべてのサブスクライバーを、復元されたパブリケーション データベースと一貫性のある状態に保つことができます。 特定のパブリケーション データベースのバックアップで再現される、以前の状態にトポロジ全体を戻す場合は、この方法を使用する必要があります。 たとえば、誤って実行したバッチ操作から復旧するメカニズムとして、パブリケーション データベースをより古い時点に復元する場合に、すべてのサブスクリプションを再初期化することができます。  
  
 このオプションを選択する場合には、パブリケーション データベースを復元した直後に、再初期化されたサブスクライバーに配信するための新しいスナップショットを生成します。  
  
 サブスクリプションを再初期化するには、「 [サブスクリプションを再初期化](../../../relational-databases/replication/reinitialize-a-subscription.md)します。  
  
 作成し、スナップショットの適用を参照してください。 [を作成し、初期スナップショットを適用](../../../relational-databases/replication/create-and-apply-the-initial-snapshot.md) と [パラメーター化されたフィルターを使用してマージ パブリケーションのスナップショットを作成](../../../relational-databases/replication/create-a-snapshot-for-a-merge-publication-with-parameterized-filters.md)します。  
  
## ディストリビューション データベースのバックアップと復元  
 マージ レプリケーションでは、ディストリビューション データベースを定期的にバックアップする必要があります。この場合、使用されるバックアップがディストリビューターを使用するすべてのパブリケーションの最短の保有期間よりも古くない限り、特に注意することなく復元できます。 たとえば、保有期間がそれぞれ 10、20、および 30 日に設定されている 3 つのパブリケーションがある場合は、10 日より長く経過したバックアップはデータベースの復元に使用できません。 マージ レプリケーションでは、ディストリビューション データベースの役割が制限されています。変更の追跡に使用されるすべてのデータは保存されず、トランザクション レプリケーションのような、サブスクリプション データベースの転送先となるマージ レプリケーションの変更の一時的な保存場所も用意されません。  
  
## サブスクリプション データベースのバックアップと復元  
 サブスクリプション データベースを正常に復元するためには、サブスクライバーとパブリッシャーを同期してから、サブスクリプション データベースをバックアップする必要があります。また、サブスクリプション データベースの復元後にも同期を行う必要があります。  
  
-   サブスクリプション データベースのバックアップの前にパブリッシャーと同期することにより、サブスクライバーをバックアップから復元した場合に、サブスクリプションをパブリケーションの保有期間内の状態に保つことができます。 たとえば、保有期間が 10 日間に設定されているパブリケーションがあるとします。 最後の同期が 8 日前で、現在バックアップが実行されています。 4 日後にバックアップが復元されると、最後の同期は 12 日前に行われたことになり、保有期間は過ぎてしまいます。 この場合は、サブスクライバーを再初期化する必要があります。 バックアップの前にサブスクライバーを同期しておくと、サブスクリプション データベースを保有期間内の状態に保つことができます。  
  
     サブスクライバーがサブスクライブするすべてのパブリケーションの最短の保有期間よりも古いバックアップは使用できません。 たとえば、保有期間がそれぞれ 10、20、および 30 日に設定されている 3 つのパブリケーションをサブスクライバーがサブスクライブする場合、10 日より長く経過したバックアップはデータベースの復元に使用できません。  
  
-   復元後にサブスクリプション データベースとそれぞれのパブリケーションを同期すると、パブリッシャーのすべての変更を含む最新の状態にサブスクライバーを保つことができます。  
  
 パブリケーションの保有期間を設定するを参照してください。 [されたサブスクリプションの有効期間を設定](../../../relational-databases/replication/publish/set-the-expiration-period-for-subscriptions.md)します。  
  
 サブスクリプションを同期するを参照してください。 [プッシュ サブスクリプションを同期する](../../../relational-databases/replication/synchronize-a-push-subscription.md) と [プル サブスクリプションを同期する](../../../relational-databases/replication/synchronize-a-pull-subscription.md)です。  
  
## 再パブリッシュ データベースのバックアップと復元  
 あるデータベースがパブリッシャーからのデータをサブスクライブしてから、同じデータを別のサブスクリプション データベースにパブリッシュするとき、このデータベースのことを再パブリッシュ データベースと言います。 再パブリッシュ データベースを復元する場合は、このトピックの「パブリケーション データベースのバックアップと復元」および「サブスクリプション データベースのバックアップと復元」で説明されているガイドラインに従ってください。  
  
## 参照  
 [SQL Server データベースのバックアップと復元](../../../relational-databases/backup-restore/back-up-and-restore-of-sql-server-databases.md)   
 [レプリケートされたデータベースのバックアップと復元](../../../relational-databases/replication/administration/back-up-and-restore-replicated-databases.md)  
  
  