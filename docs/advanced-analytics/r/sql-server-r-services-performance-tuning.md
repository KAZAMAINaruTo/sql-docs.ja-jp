---
title: "SQL Server R Services のパフォーマンス チューニング | Microsoft Docs"
ms.custom: 
ms.date: 07/12/2017
ms.prod: sql-server-2016
ms.reviewer: 
ms.suite: 
ms.technology:
- r-services
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: cf6f3b7d-f9f9-4e45-b0d1-07850b53e0c5
caps.latest.revision: 20
author: jeannt
ms.author: jeannt
manager: jhubbard
ms.translationtype: MT
ms.sourcegitcommit: 876522142756bca05416a1afff3cf10467f4c7f1
ms.openlocfilehash: 161f42e2559725b41df605c1e1c2ca12acae9c97
ms.contentlocale: ja-jp
ms.lasthandoff: 09/01/2017

---
# <a name="performance-tuning-for-r-in-sql-server"></a>SQL Server で R のパフォーマンスの調整

この記事では、一連の 2 つのケース スタディに基づいて、R Services のパフォーマンスの最適化について説明する 4 つの記事の最初。

- R ソリューションのパフォーマンス プロファイルを検証する、製品開発チームによって実施パフォーマンス テスト

- 多くの場合、お客様から要求された特定の機械学習シナリオでは、Microsoft データ サイエンス チームのパフォーマンスの最適化。

この系列の目的は、パフォーマンス チューニング技法は、SQL Server で R ジョブを実行するため最も便利なの種類についてのガイダンスを提供します。

+ この (最初) のトピックは、データ サイエンス タスクに最適化するときに、アーキテクチャ、一般的な問題についての概要を示します。
+ 2 番目の記事では、特定のハードウェアおよび SQL Server の最適化について説明します。
+ 3 番目の記事では、R コードと操作運用のリソースでの最適化について説明します。
+ 4 番目の記事では、詳細、およびレポート結果結論にテスト メソッドについて説明します。

**適用されます:** SQL Server 2016 の R Services、SQL Server 2017 機械学習のサービス

## <a name="performance-goals-and-targeted-scenarios"></a>パフォーマンス目標、および対象となるシナリオ

R Services の機能は、SQL Server で R スクリプトの実行をサポートするために SQL Server 2016 で導入されました。 この機能を使用すると、R ランタイムは、データベース エンジンから別のプロセスで動作しますが、信頼済みのスタート パッドなどの SQL サーバーとサーバーのリソースと対話するサービスを使用して、データベース エンジンとデータを安全に交換します。

SQL Server 2017、サポートに将来的に実行する追加の言語で、同じアーキテクチャを使用して Python スクリプトの実行に関する発表されました。

データベース管理者とデータベースの設計者は、machine learning のジョブが原因のリソースの競合が発生する可能性を認識およびそのデータがサポートするためにサーバーを構成することが重要です。 サポートされるバージョンと言語の数が増大すると、新しいワークロード。 データの近くで分析を維持すると、安全でないデータ移動が回避できますも、データをホストしているサーバーに戻すと、データ サイエンティストのラップトップ コンピューター オフ分析ワークロードを移動します。

機械学習のパフォーマンスを最適化は明確に万能の公式提案します。 次の一般的なタスクは、非常にさまざまなパフォーマンス プロファイルがあります。

- タスクのトレーニング: を作成して、ニューラル ネットワークのトレーニングと回帰モデルのトレーニング
- T-SQL を使用して特徴を抽出と R を使用して特徴エンジニア リング
- 1 行または表形式の入力を使用してスコア付け一括と、小さいバッチに分割のスコア付け
- ストアド プロシージャで SQL Server の実稼働環境にモデルの配置と R でスコアリングを実行しています。
- データ転送を最小限に抑えるか、コストの高いデータ変換を削除する R コードを変更します。
- 自動テストとモデルの再トレーニングを有効にします。

最適化の手法の選択は、どのタスクが、アプリケーションまたはユース ケースの重要なに依存するため、ケース スタディは全般的パフォーマンスのヒント、および、特定のシナリオ、バッチ スコアリングのための最適化を最適化する方法についてのガイダンスの両方について説明します。

+ **SQL Server での個々 の最適化オプション**

    最初のパフォーマンスのケース スタディ モデルの 1 つの型を使用して 1 つのデータセットに複数のテストが実行されました。 モデルを構築し、そこからスコアを作成する RevoscaleR で rxLinMod アルゴリズムが使用されましたが、コードだけでなく、基になるデータ テーブルが各変更の影響をテストする体系的に変更されました。

    たとえば、1 回のテストを実行、R コードが変更された比較ができると機能を事前計算、テーブルからの機能を読み込む変換関数を使用して特徴エンジニア リングできるようにします。 別のテストの実行、モデルのトレーニング パフォーマンスがさまざまな種類の圧縮、または新しいインデックスの種類を含むテーブルのデータと標準インデックス付きテーブルを使って間と比較されます。

+ **特定の大量のスコア付けシナリオの最適化**

    2 番目のケース スタディの機械学習タスクでは、複数の位置に対して送信され、ジョブの位置ごとに最適な候補を検索する多くの再開を処理します。 二項分類の問題として、機械学習モデル自体を公式化: 入力値として resume およびジョブの説明を使用してジョブの再開の各ペアの確率が生成されます。 目標は、最適な一致を見つけるには、のでユーザー定義の確率しきい値を使用して、さらにフィルターを適用し、適切な一致のみが取得されます。

    このソリューションでは、主な目的は、スコア計算中に、低待機時間を実現するためにしました。 ただし、このタスクは、スコア付けプロセス中にも負荷の大きい新しい各ジョブは、何百万もの妥当な期間内で再開に対して一致する必要があるためです。 さらに、機能のエンジニア リング手順では、再開、または、ジョブあたり 2,000 台以上の機能を生成し、大幅なパフォーマンスのボトルネックとなっています。

すべての結果を決定する手法は、ソリューションに適用可能な最初のケース スタディを確認し、潜在的な影響を比較検討することをお勧めします。

次に、作成者のさまざまな手法を適用および特定のワークロードをサポートするためにサーバーを最適化して、スコア付けの最適化ケース スタディの結果を確認します。

## <a name="performance-optimization-process"></a>パフォーマンスの最適化プロセス

構成とパフォーマンスのチューニングは、特定のワークロード用に設計されたレイヤー最適化を純色のベースを作成する必要があります。

- ホストの分析の適切なサーバーを選択します。 通常、セカンダリ レポート、データ ウェアハウスまたはその他のレポートまたは分析のために既に使用されているその他のサーバーをお勧めします。 ただし、ソリューションではハイブリッド トランザクション分析処理 (HTAP)、オペレーション データできますとして使用する R への入力の高速なスコアを計算します。

- 分散データベース エンジンの操作と R に SQL Server インスタンスを構成または Python スクリプトの適切なレベルで実行します。 これは、メモリと CPU 使用率、NUMA とプロセッサのアフィニティ設定、およびリソース グループの作成用の SQL Server の既定値の変更を含めることができます。

- 外部スクリプトの効率的な使用をサポートするために、サーバー コンピューターを最適化します。 これは、パッケージの管理を有効にすると、外部スクリプトの実行に使用されるアカウントの数を増やすことを含めることができ、関連するセキュリティ ロールを割り当てるユーザーをします。

- データの格納とインデックス作成など、SQL Server と統計戦略、クエリのデザインおよびクエリの最適化、および機械学習に使用されるテーブルのデザインに転送するには、特定の最適化を適用します。 データ ソースを分析することもあり、トランスポートのメソッド、または機能の展開を最適化するために、ETL プロセスを変更するデータ。

- 非効率性を避けるために分析モデルを調整します。 可能な最適化のスコープは、R コードおよびパッケージとを使用しているデータの複雑さによって異なります。 主なタスクには、コストの高いデータ変換を削除するか、タスクをオフロードするデータの準備や機能エンジニア リング R または Python から ETL プロセスまたは SQL が含まれます。 可能性がありますもスクリプトをリファクター、削除行でパッケージのインストールが、トレーニング、スコア付け、および evaluation、別のプロシージャに R コードを分割またはストアド プロシージャとして効率的に作業するためのコードを簡略化します。

## <a name="articles-in-this-series"></a>この系列内のアーティクル

+ [SQL Server のハードウェアでの R のパフォーマンスの調整](..\r\sql-server-configuration-r-services.md)

    ハードウェアを構成するためのガイダンスを提供する[!INCLUDE [ssNoVersion_md](..\..\includes\ssnoversion-md.md) ]および外部スクリプトのサポートを向上させる SQL Server インスタンスを構成するためにインストールします。 特に便利ですが**データベース管理者**です。

+ [SQL Server - コードとデータの R のパフォーマンスの調整の最適化](..\r\r-and-data-optimization-r-services.md)

    既知の問題を回避する外部のスクリプトを最適化する方法に関する特定のヒントを提供します。 最も役に立つは**データ サイエンティスト**です。

    [!NOTE]
    > R、一般にはこのセクションの情報の多く、一部の情報は、RevoScaleR 分析関数に固有です。 詳細なパフォーマンス ガイダンスでは使用できません**revoscalepy**およびその他の Python ライブラリがサポートされています。

+ [SQL Server - メソッドと結果の R のパフォーマンスの調整](..\r\performance-case-study-r-services.md)

    概要データが 2 つのケース スタディ、パフォーマンスのテスト方法および使用の最適化が結果に影響をします。
