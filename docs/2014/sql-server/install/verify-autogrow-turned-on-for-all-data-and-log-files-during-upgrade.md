---
title: 自動拡張をオンにすべてのデータとログ ファイルのアップグレード プロセス中に |Microsoft ドキュメント
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.suite: ''
ms.technology:
- database-engine
ms.tgt_pltfrm: ''
ms.topic: article
helpviewer_keywords:
- log files [SQL Server], size
- data files [SQL Server], size
- tempdb [SQL Server], size
- autogrow [SQL Server]
ms.assetid: a5860904-e2be-4224-8a51-df18a10d3fb9
caps.latest.revision: 23
author: JennieHubbard
ms.author: jhubbard
manager: jhubbard
ms.openlocfilehash: b903e8f22fce7404f418cfc0a81ac81e954ab06f
ms.sourcegitcommit: 5dd5cad0c1bbd308471d6c885f516948ad67dfcf
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/19/2018
ms.locfileid: "36071368"
---
# <a name="verify-autogrow-is-turned-on-for-all-data-and-log-files-during-the-upgrade-process"></a>アップグレード処理中、すべてのデータ ファイルとログ ファイルの自動拡張が有効になっていることを確認する
  アップグレード アドバイザーによって、自動拡張に設定されていないデータまたはログ ファイルが検出されました。 新機能および強化された機能がユーザー データベースの追加のディスク領域を必要とし、 **tempdb**システム データベースです。 アップグレードし、その後の本番操作時にリソースがサイズ増加に対応できることを確認するには、ことをお勧めすべてのユーザー データとログ ファイルの自動拡張をオンに設定され、 **tempdb**データ ファイルとログ ファイルをアップグレードする前にします。  
  
 アップグレードを完了し、作業負荷をテストした後、必要に応じてユーザー データ ファイルとログ ファイルの自動拡張をオフにしたり、FILEGROWTH 増分値を調整してください。 その自動拡張のままにことをお勧め、 **tempdb**システム データベースです。 詳細については、[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] オンライン ブックの「tempdb に使用するディスク領域の計画」を参照してください。  
  
## <a name="component"></a>コンポーネント  
 [!INCLUDE[ssDE](../../includes/ssde-md.md)]  
  
## <a name="description"></a>説明  
 **データ ファイル**  
  
 次の表に示す [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] の機能変更では、ユーザー定義データ ファイル用に追加ディスク領域が必要となります。  
  
|機能|[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] から導入された変更|  
|-------------|-----------------------------------------------------|  
|フルテキスト|ドキュメント ID (DOCID) マップは、フルテキスト カタログではなく、データ ファイルに格納されます。|  
|`text`、`ntext`、`image` の各列|`text`、`ntext`、または `image` のデータ型として定義されるラージ オブジェクト (LOB) 列には、列ごとに 40 バイトのディスク領域を追加する必要があります。 この 1 回限りの領域増加は、各 LOB 列の初回更新時に発生します。|  
|メタデータ (metadata)|追加のシステム メタデータが、データベース オブジェクトおよびユーザー権限の各ユーザー データベースの PRIMARY ファイル グループに作成および保持されます。 たとえば、以前のバージョンの [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] では、権限を与えるユーザーまたは権限が与えられるユーザーに関連する権限は、ビットマップとして 1 つの行に格納されます。 そのビットマップが複数の行に拡張されます。<br /><br /> そのため、アップグレード時に、古いメタデータと新しいメタデータの両方を格納するのに十分なディスク領域を確保する必要があります。 古いメタデータは、アップグレード完了後に削除されます。|  
  
 **トランザクション ログ ファイル**  
  
 次の表に示す [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] の機能変更では、ユーザー定義トランザクション ログ ファイル用に追加ディスク領域が必要となります。  
  
|機能|[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] から導入された変更|  
|-------------|-----------------------------------------------------|  
|復元および復旧|クラッシュ復旧の元に戻すフェーズの間、[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] を使用してデータベースにアクセスできます。 これは、クラッシュの発生時にコミットされなかったトランザクションに、クラッシュ前に保持されたロックが必要であるためです。 トランザクションのロールバック中に、トランザクションのロックによってユーザーによる介入からトランザクションが保護されます。 このロックに関する追加情報は、トランザクション ログに保持されます。|  
  
 **tempdb データ ファイルとログ ファイル**  
  
 以前のバージョンの[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]、 **tempdb**データベースは、次のオブジェクトの格納に使用します。  
  
-   テーブル、ストアド プロシージャ、テーブル変数、カーソルなどの明示的に作成される一時オブジェクト  
  
-   [!INCLUDE[ssDE](../../includes/ssde-md.md)]によって作成される内部作業テーブル  
  
-   インデックスの作成や再構築時の一時ソートによる結果 (SORT_IN_TEMPDB を指定した場合)  
  
 その他のオブジェクトも使用する、 **tempdb**データベース。 次の表は、変更または追加する[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]になる追加機能に必要な領域をディスク**tempdb**データとログ ファイルです。  
  
|機能|[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] から導入された変更|  
|-------------|-----------------------------------------------------|  
|行のバージョン管理|行のバージョン管理は、一般的なフレームワーク[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]する目的で使用されます。<br /><br /> トリガーをサポートします。 トリガーで inserted および deleted テーブルを構築します。 トリガーによって変更された行はすべて、バージョン化されます。 これには、トリガーによりデータが変更された行だけでなく、トリガーを起動したステートメントにより変更された行も含まれます。 トリガーのバージョン ストアを使用して後**tempdb**保持するために、トリガーによって変更される行の直前のイメージです。 トリガーを有効にしてデータを一括読み込みする場合、各行のコピーをバージョン ストアに追加する。<br /><br /> 複数のアクティブな結果セット (MARS) をサポートする。 アクティブな結果セットが存在するときに、MARS セッションでデータ変更ステートメント (INSERT、UPDATE、DELETE など) が実行された場合、その変更ステートメントの影響を受けた行はバージョン化されます。<br /><br /> ONLINE オプションを指定するインデックス操作をサポートする。 オンライン インデックス操作では、行のバージョン管理を使用して、他のトランザクションによる変更がインデックス操作に影響を与えないようにしています。 そのため、読み取った行の共有ロックを要求する必要がなくなります。 さらに、同時実行ユーザー更新操作時および削除オンラインのインデックスの領域が必要にバージョン レコード用**tempdb**です。<br /><br /> 行バージョン ベースのトランザクション分離レベルのサポート: 読み取りの新しい実装は、行のバージョン管理を使用してステートメント レベルの読み取りの一貫性を提供する分離レベルをコミットします。 新しい分離レベルであるスナップショット。このレベルにより、トランザクションレベルの読み取り一貫性を実現します。<br /><br /> <br /><br /> 行のバージョンに保持されます、 **tempdb**バージョン ストアの行バージョン管理に基づく分離レベルで実行されているトランザクションの要件を満たすために十分な長さです。<br /><br /> 行バージョンおよびバージョン ストアの詳細については、[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] オンライン ブックの「行のバージョン管理に基づく分離レベルについて」を参照してください。|  
|一時テーブルおよび一時変数メタデータのキャッシュ|一時テーブルおよび一時変数によってメタデータ キャッシュ内の各メタデータ[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]に 2 つの余分なページが割り当てられた**tempdb**です。<br /><br /> ストアド プロシージャまたはトリガーで一時テーブルまたは一時変数を作成する場合、そのプロシージャまたはトリガーによる実行が完了しても、一時オブジェクトは削除されません。 その代わりに、一時オブジェクトが 1 ページに切り詰められ、そのプロシージャまたはトリガーを次回に実行するときに再利用されます。|  
|パーティション テーブルのインデックス|ときに、[!INCLUDE[ssDE](../../includes/ssde-md.md)]パーティション インデックスで必要な各パーティションの中間並べ替え実行結果を保持するために十分な領域を作成するための並べ替えを実行**tempdb** SORT_IN_TEMPDB インデックス オプションが指定されている場合。|  
|[!INCLUDE[ssSB](../../includes/sssb-md.md)]|[!INCLUDE[ssSB](../../includes/sssb-md.md)] 明示的に使用**tempdb**メモリ (ダイアログあたり約 1 KB) に保存できない既存のダイアログ コンテキストを保持する場合。<br /><br /> [!INCLUDE[ssSB](../../includes/sssb-md.md)] 暗黙的に使用**tempdb**クエリの実行のコンテキスト内のオブジェクトのキャッシュを介したです。 たとえば、タイマー イベントに使用される作業テーブルおよびバックグラウンド送信メッセージ交換で使用します。<br /><br /> DBMail、イベント通知、およびクエリ通知の機能では、[!INCLUDE[ssSB](../../includes/sssb-md.md)] を暗黙的に使用します。|  
|ラージ オブジェクト (LOB) のデータ型<br /><br /> LOB の変数およびパラメーター|データ型`varchar(max)`、 `nvarchar(max)`、 **varbinary (max) テキスト**、 `ntext`、`image,`と`xml`はラージ オブジェクト型。<br /><br /> 変更された LOB のフラグメントがバージョン ストアにコピーされた行のバージョン管理ベースのトランザクション分離レベルが、データベースで有効にすると、ラージ オブジェクトの変更が行われる、 **tempdb**です。<br /><br /> ラージ オブジェクト データ型として定義されているパラメーターに格納されます**tempdb**です。|  
|共通テーブル式 (Cte)|スプール操作の一時作業テーブルに作成されます**tempdb**共通テーブル式のクエリが実行されます。|  
  
## <a name="corrective-action"></a>修正措置  
 データまたはログ ファイルを自動拡張に設定するには、データベースのデータおよびログを指定するように以下のステートメントを変更してください。 また FILEGROWTH 増分値を、使用している環境で適切な値に調整する必要があります。  
  
```  
ALTER DATABASE tempdb  
MODIFY FILE  
    (NAME = tempdev,  
    FILEGROWTH = 20MB);  
GO  
ALTER DATABASE tempdb  
MODIFY FILE  
    (NAME = templog,  
    FILEGROWTH = 10MB);  
```  
  
 データ ファイルの既定の拡張増分値が 1 MB になります。 ログ ファイルの既定値は 10% です。 FILEGROWTH 増分値を設定するときは、次の一般的なガイドラインに従うことをお勧めします。  
  
|ファイルのサイズ|FILEGROWTH 増分値|  
|---------------|--------------------------|  
|0 ～ 50 MB|10 MB|  
|100 ～ 200 MB|20 MB|  
|500 MB 以上|10%|  
  
## <a name="see-also"></a>参照  
 [データベース エンジンのアップグレードに関する問題](../../../2014/sql-server/install/database-engine-upgrade-issues.md)   
 [SQL Server 2014 アップグレード アドバイザー&#91;新規&#93;](/sql/2014/sql-server/install/sql-server-2014-upgrade-advisor)  
  
  
