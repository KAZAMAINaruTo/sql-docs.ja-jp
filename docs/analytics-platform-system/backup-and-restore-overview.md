---
title: バックアップと復元の Parallel Data Warehouse |Microsoft ドキュメント
description: データのバックアップし、復元は並列データ ウェアハウス (PDW) について説明します。 バックアップと復元操作は、災害復旧のために使用されます。 バックアップと復元は、1 つのアプライアンスから別のアプライアンスにデータベースをコピーするも使用できます。
author: mzaman1
manager: craigg
ms.prod: sql
ms.technology: data-warehouse
ms.topic: conceptual
ms.date: 04/17/2018
ms.author: murshedz
ms.reviewer: martinle
ms.openlocfilehash: 118b9ced12e01ac6655d85969bb61717f2b31e0b
ms.sourcegitcommit: 056ce753c2d6b85cd78be4fc6a29c2b4daaaf26c
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/19/2018
---
# <a name="backup-and-restore"></a>バックアップと復元
データのバックアップし、復元は並列データ ウェアハウス (PDW) について説明します。 バックアップと復元操作は、災害復旧のために使用されます。 バックアップと復元は、1 つのアプライアンスから別のアプライアンスにデータベースをコピーするも使用できます。  
    
## <a name="BackupRestoreBasics"></a>バックアップと復元の基本事項  
PDW*データベースのバックアップ*アプライアンスに、元のデータベースを復元するために使用できるようにの形式で格納されている、アプライアンスのデータベースのコピーです。  
  
ディストリビューション データベースのバックアップを作成、[データベースのバックアップ](../t-sql/statements/backup-database-parallel-data-warehouse.md)t-sql ステートメントで使用する書式設定されたと、[データベースの復元](../t-sql/statements/restore-database-parallel-data-warehouse.md)ステートメントは使用できません、他の目的。 バックアップは、同じ数より多くのコンピューティング ノードのアプライアンスにしか復元できません。  
  
<!-- MISSING LINKS

The [master database](master-database.md) is a SMP SQL Server database. It is backed up with the BACKUP DATABASE statement. To restore master, use the [Restore the Master Database](configuration-manager-restore-master-database.md) page of the Configuration Manager tool.  

-->
  
PDW では、バックアップし、復元のアプライアンス データベースに SQL Server のバックアップ テクノロジを使用します。 バックアップの圧縮を使用するのには、SQL Server のバックアップ オプションが構成済みです。 圧縮、チェックサム、ブロック サイズ、バッファー カウントなど、バックアップ オプションを設定することはできません。  
  
データベースのバックアップ サーバーに保存されて 1 つまたは複数バックアップ、カスタマー ネットワークに存在します。  PDW では、1 つのサーバーのバックアップを並列で計算ノードから直接ユーザー データベースのバックアップを書き込み、バックアップ サーバーから直接、コンピューティング ノードを並列でユーザー データベース バックアップを復元します。  
  
バックアップは、Windows ファイル システムで、バックアップ サーバーで、一連のファイルとして保存されます。 PDW のデータベースのバックアップは、PDW にしか復元できません。 ただし、標準の Windows ファイルのバックアップ プロセスを使用して、別の場所にサーバーのバックアップからデータベースのバックアップをアーカイブできます。 バックアップ サーバーの詳細については、次を参照してください。[取得し、サーバーのバックアップを構成](acquire-and-configure-backup-server.md)です。  
  
## <a name="BackupTypes"></a>データベース バックアップの種類  
2 つの種類のデータをバックアップする必要がある: ユーザー データベースやシステム データベース (master データベースなど)。 PDW は、トランザクション ログをバックアップできません。  
  
データベースの完全バックアップは、PDW データベース全体のバックアップです。 これは、既定のバックアップの種類です。 ユーザー データベースの完全バックアップには、データベース ユーザー、およびデータベース ロールが含まれています。 Master データベースのバックアップには、ログインが含まれています。  
  
差分バックアップには、前回の完全バックアップ以降、変更のすべてが含まれます。 通常、差分バックアップは完全バックアップよりも短時間で完了します。完全バックアップよりも頻繁に実行できます。 複数の差分バックアップは、同一の完全バックアップに基づいている場合、各差分バックアップはすべての変更を以前の差分に含めます。  
  
たとえば、毎週完全バックアップと差分バックアップを毎日を作成できます。 ユーザー データベース、完全バックアップのほかを最後に復元するには、差分バックアップ (が存在する場合) 必要がありますを復元します。  
  
差分バックアップは、ユーザー データベースに対してのみサポートされます。 Master データベースのバックアップは、常に完全バックアップです。  
  
全体のアプライアンスをバックアップするには、すべてのユーザー データベースのバックアップと master データベースのバックアップを実行する必要があります。  
  
## <a name="BackupProc"></a>データベースのバックアップ プロセス  
次の図は、データベースのバックアップ中のデータ フローを示します。  
  
![PDW バックアップ プロセス](media/backup-process.png "PDW バックアップ プロセス")  
  
バックアップ プロセスは次のとおりです。  
  
1.  ユーザーは、管理ノードに BACKUP DATABASE tsql ステートメントを送信します。  
  
    -   バックアップは、完全または差分バックアップのどちらかです。  
  
2.  ユーザー データベースの場合は、コントロールのノード (MPP エンジン) は、並列データベース バックアップを実行する分散クエリ プランを作成します。  
  
3.  各ノードでは、SQL Server バックアップ機能を使用してサーバーをバックアップするバックアップ、ファイル バックアップのコピーに関与します。  
  
    -   各ノードには、1 つバックアップ ファイル バックアップ サーバーにコピーにはが含まれています。  
  
    -   ユーザー データベースのバックアップ (完全または差分) には、各計算ノードとのデータベース ユーザーとデータベース ロールのバックアップに格納されたデータベースの部分のバックアップが含まれています。  
  
4.  アプライアンスは、並列の InfiniBand ネットワークを使用して、バックアップを実行します。  
  
    -   PDW では、各完全バックアップと差分バックアップを並列で実行します。 ただし、複数のデータベース バックアップは同時に実行しません。 各バックアップ要求は、以前に送信されたバックアップを完了を待つ必要があります。  
  
    -   Master データベースのバックアップは、のみ、[管理] ノードからデータをバックアップします。 このバックアップの種類は順番に実行されます。  
  
5.  PDW のデータベースのバックアップは、アプライアンス オフが存在するディレクトリに格納されているファイルのグループです。 ディレクトリ名は、ネットワーク パスとディレクトリ名として指定されます。 ディレクトリがローカル パスにすることはできず、アプライアンスのことはできません。  
  
6.  バックアップが完了したら、必要に応じて、バックアップ ディレクトリを別の場所にコピーするのに、Windows ファイル システムを使用することができます。  
  
    -   バックアップは、コンピューティング ノードの数が同じかそれ以上 PDW アプライアンスにしか復元できません。  
  
    -   復元を実行する前にバックアップの名前を変更することはできません。 バックアップ ディレクトリの名前は、バックアップの元の名前の名前と一致する必要があります。 バックアップの元の名前は、バックアップ ディレクトリ内での backup.xml ファイルに格納されます。 別の名前にデータベースを復元するには、restore コマンドで、新しい名前を指定できます。 たとえば、 `RESTORE DATABASE MyDB1 FROM DISK = ꞌ\\10.192.10.10\backups\MyDB2ꞌ`のようにします。  
  
## <a name="RestoreModes"></a>データベースの復元モード  
データベース全体の復元は、データベースのバックアップにデータを使用して、ディストリビューション データベースを再作成されます。 データベースの復元は、最初に、完全バックアップを復元して、1 つの差分バックアップを必要に応じて復元によって実行されます。 データベースの復元には、データベース ユーザーとデータベース ロールが含まれています。  
  
ヘッダーのみの復元では、データベースのヘッダー情報を返します。 アプライアンスにデータは復元されません。  
  
アプライアンス復元は、全体のアプライアンスの復元です。 これには、すべてのユーザー データベースと master データベースの復元が含まれます。  
  
## <a name="RestoreProc"></a>復元プロセス  
次の図は、データベースの復元中のデータ フローを示します。  
  
![復元処理](media/restore-process.png "復元プロセス")  
  
## <a name="restoring-to-an-appliance-with-the-same-number-of-compute-nodes"></a>同じ数のコンピューティング ノード * * とアプライアンスへの復元  
  
データを復元するときに、アプライアンスは、ソース アプライアンスと移行先のアプライアンスにコンピューティング ノードの数を検出します。 両方のアプライアンスのコンピューティング ノードの数が等しい場合は、復元プロセスは次のように動作します。  
  
1.  復元するデータベースのバックアップは、非アプライアンス バックアップ サーバー上の Windows ファイル共有で使用できます。 最適なパフォーマンスをこのサーバーは通常、アプライアンスの InfiniBand ネットワークに接続します。  
  
2.  ユーザーが送信、 [RESTORE DATABASE](../t-sql/statements/restore-database-parallel-data-warehouse.md)管理ノードに tsql ステートメントです。  
  
    -   完全な復元、またはヘッダーの復元は、復元します。 完全復元は、完全バックアップが復元され、し、必要に応じて差分バックアップを復元します。  
  
3.  コントロールのノード (MPP エンジン) では、並列データベース復元を実行する分散クエリ プランを作成します。  
  
    -   SQL ServerPDW は、ユーザー データベースの復元を並列で実行します。 ただし、複数のデータベースのバックアップと復元は、並列に実行しません。 MPP エンジンをキューには、各復元ステートメントを配置します。待機以前に送信されたバックアップおよび復元要求を完了する必要があります。  
  
    -   Master データベースの復元がコントロールのノードにのみデータを復元します。復元を逐次的に実行します。  
  
    -   ヘッダー情報の復元がクイック操作でありコンピューティングまたはコントロールのノードにデータは復元しません。 代わりに、コントロールのノードは、クエリの出力として結果を返します。  
  
4.  バックアップ ファイルは、アプライアンスの InfiniBand ネットワーク経由で通常並列で計算ノードと適切なコピーを取得します。  
  
5.  各コンピューティング ノードでは、ユーザー データベースの部分を復元します。 復元が正常に完了しないと場合のすべてのデータベースが削除され、復元が正常に完了します。  
  
## <a name="restoring-to-an-appliance-with-a-larger-number-of-compute-nodes"></a>使用コンピューティング ノードの数が多いアプライアンスへの復元  
  
より多くの計算ノードを備えたアプライアンスにバックアップを復元すると、計算ノードの数に比例して、割り当てられるデータベースのサイズが大きくなります。  
  
たとえば、2 つのノード アプライアンス (ノードあたり 30 GB) から 60 GB のデータベースを復元する、6 ノード アプライアンスに、ときに SQL Server PDW は 6 ノード アプライアンス上 180 GB のデータベース (6 ノード 30 GB を持つ 1 つのノード) を作成します。 SQL Server PDW では、ソースの構成と一致する 2 つのノードには、最初に、データベースを復元し、6 つのすべてのノードにデータを分配します。  
  
再割り当て後の各計算ノードでは、小さい方のソース アプライアンス上の各計算ノードと比べて、含まれる実際のデータが少なくなり、空き領域が大きくなります。 追加の領域を使用して、データベースにデータを追加します。 使用することができます、復元されたデータベースのサイズが大きい場合、必要以上、 [ALTER DATABASE](../t-sql/statements/alter-database-parallel-data-warehouse.md)データベース ファイルのサイズを縮小します。  
  
## <a name="related-tasks"></a>関連タスク  
  
|バックアップと復元タスク|Description|  
|---------------------------|---------------|  
|バックアップ サーバーとして、サーバーを準備します。|[取得して、サーバーのバックアップを構成します。 ](acquire-and-configure-backup-server.md)|  
|データベースをバックアップします。|[データベースのバックアップ](../t-sql/statements/backup-database-parallel-data-warehouse.md)|  
|データベースを復元します。|[データベースを復元します。](../t-sql/statements/restore-database-parallel-data-warehouse.md)|    
<!-- MISSING LINKS
|Create a disaster recovery plan.|[Create a Disaster Recovery Plan](create-disaster-recovery-plan.md)|
|Restore the master database.|To restore the master database, use the [Restore the master database](configuration-manager-restore-master-database.md) page in the Configuration Manager tool.| 
|Copy a database from one appliance to another appliance.|[Copy a PDW database to another appliance](copy-pdw-database-to-another-appliance.md).|  
|Monitor backups and restores.|[Monitor backups and restores](monitor-backup-and-restore.md)|  
-->
